# Privilege Escalation and Maintaining Access

* Types of privilege escalation
  - Vertical
    - The attacker is able to move from a lower privileged user to a higher privileged user. For example from a low-end user to administrator or root user.
  - Horizontal: 
    - The attacker keeps the same set or level of privileges but assumes the identity of a different user (he/she does not gain any further privilege).


---

### Maintaining Access

In this phase we will make sure that our session is :

+ Stable (does not get dropped)
  - One of the main issues when you get a meterpreter session on the target, is that the end user can kill the exploited process. It can happen, for example, when you exploit a client-side vulnerability through the web browser and the user just closes the web browser window.
+ Privileged (can run with high privileges)
+ Persistent (through reboots)




---

* Stable

Our goal of making our session stable. To let Metasploit automatically migrate to another process, you can use the following command (on windows machine):

> run post/windows/manage/migrate

---

* Windows Privilege Escalation

The easiest and fastest way to get higher privileges is by running getsystem within meterpreter.It will automatically find the best technique to elevate privileges.

![image](https://user-images.githubusercontent.com/73122852/234651603-834739f8-11fb-4bd1-a4ed-9baf2b8ada39.png)


Notice that depending on the current privileges on the machine, the getsystem command may fail. For example, if you use this technique on systems with User Account Control (UAC) enabled (Windows Vista+), it will not work as well as systems like Windows XP.

When UAC is enabled on the remote system, bypassuac is one of the modules we can use to bypass it.

First of all, we can verify if UAC is enabled by running the module post/windows/gather/win_privs.

If in the result the UAC Enabled column is set to true, it means that the remote system has the UAC enabled.








